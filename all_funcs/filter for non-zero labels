def filter_labels(matrix):
    filtered_labeled_matrix = []
    filtered_testing_matrix = []
    
    for i in range(matrix.shape[0]):
        # Create a mask to filter out rows where the last column is 0
        mask = matrix[i, :, -1] != 0

        # Select only masked rows for training, excluding the last row
        filtered_matrix = matrix[i, :-1, :][mask[:-1]]
        
        # Append the filtered training data
        filtered_labeled_matrix.append(filtered_matrix)
        
        # Use the last row of the matrix as the testing data for that sample
        filtered_testing_matrix.append(matrix[i, -1, :])
        
    # Concatenate all filtered matrices along the first axis for training
    total_filtered_matrix = np.concatenate(filtered_labeled_matrix, axis=0) if filtered_labeled_matrix else np.empty((0, matrix.shape[2]))
    
    # Stack the last rows for testing into a single matrix
    testing_matrix = np.stack(filtered_testing_matrix, axis=0) if filtered_testing_matrix else np.empty((0, matrix.shape[2]))

    return total_filtered_matrix, testing_matrix

print('Done')
